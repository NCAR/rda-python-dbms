{{- if .Values.db.backups.s3.enabled }}
apiVersion: postgresql.cnpg.io/v1
kind: ScheduledBackup
metadata:
  name: {{ .Values.db.name }}-s3-backup
  namespace: {{ .Release.Namespace }}
  labels:
    app: {{ .Values.db.name }}
spec:
  # Schedule: Roughly midnight local time 
  schedule: "0 0 5 */3 * *"
  
  backupOwnerReference: self
  
  cluster:
    name: {{ .Values.db.name }}
  
  target: primary
  method: plugin
  pluginConfiguration:
    name: barman-cloud.cloudnative-pg.io
{{- end }}